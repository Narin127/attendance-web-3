<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ระบบเช็คชื่อนักเรียนอัจฉริยะ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {font-family: Arial;background:#f4f6f9;margin:0;}
header {background:white;padding:20px;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.container {padding:20px;}
.card {display:inline-block;width:30%;padding:20px;border-radius:12px;text-align:center;margin:10px;font-size:22px;}
.blue {background:#dbeafe;}
.yellow {background:#fef3c7;}
.red {background:#fecaca;}
button {padding:10px 20px;margin:5px;border-radius:8px;border:none;cursor:pointer;}
</style>
</head>
<body>

<header>
<h2>ระบบเช็คชื่อนักเรียนอัจฉริยะ</h2>
</header>

<div class="container">

<div class="card blue">
มาเรียน
<div id="present">0</div>
</div>

<div class="card yellow">
มาสาย
<div id="late">0</div>
</div>

<div class="card red">
ขาด/ลา
<div id="absent">0</div>
</div>

<br><br>

<h3>เช็คชื่อ</h3>

<input type="text" id="studentId" placeholder="รหัสนักเรียน">
<input type="text" id="name" placeholder="ชื่อ">
<input type="text" id="class" placeholder="ห้อง">

<br>

<button onclick="check('มาเรียน')">มาเรียน</button>
<button onclick="check('มาสาย')">มาสาย</button>
<button onclick="check('ขาด')">ขาด</button>

<br><br>

<canvas id="chart"></canvas>

</div>

<script>

const URL_APPS_SCRIPT = "https://script.google.com/macros/s/AKfycbx6lm-fM1oTHmIGOObYaQRPNxIz1HzF5_Cw8sFtW8OAYm2g4poJZpgbUp_4yoZJvyfDAA/exec";

function check(status) {

fetch(URL_APPS_SCRIPT, {
method: "POST",
body: JSON.stringify({
studentId: document.getElementById("studentId").value,
name: document.getElementById("name").value,
class: document.getElementById("class").value,
status: status
})
}).then(res => res.json())
.then(data => {
alert("บันทึกแล้ว");
loadData();
});

}

function loadData() {

fetch(URL_APPS_SCRIPT)
.then(res => res.json())
.then(data => {

let present = 0;
let late = 0;
let absent = 0;

for(let i=1; i<data.length; i++){
if(data[i][4] === "มาเรียน") present++;
if(data[i][4] === "มาสาย") late++;
if(data[i][4] === "ขาด") absent++;
}

document.getElementById("present").innerText = present;
document.getElementById("late").innerText = late;
document.getElementById("absent").innerText = absent;

createChart(present, late, absent);

});
}

function createChart(p,l,a) {
new Chart(document.getElementById("chart"), {
type: "pie",
data: {
labels: ["มาเรียน","มาสาย","ขาด"],
datasets: [{
data: [p,l,a]
}]
}
});
}

loadData();

</script>

</body>
</html>
